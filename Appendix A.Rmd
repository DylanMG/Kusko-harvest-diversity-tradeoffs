---
title: 'Appendix A: Stationary Ricker to cyclical Beveton-Holt spawner-recruit formulation'
author: "B. Connors"
date: "July 23, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("load.R")
```

In our baseline simulations we assumed that recruitment dynamics are governed by stationary spawner-recruitment dynamics that follow a Ricker-type relationship with overcompensation at high spawner abundances (equations 1-3). This is the state of nature that is currently assumed by fishery managers in the Kuskokwim and widely across other salmon fisheries. We also considered an alternative recruitment hypothesis that assumed that low frequency regime shifts occur that gave rise to the appearance of overcompensation, when in fact none was present. Under this hypothesis we assumed that individual spawner-recruitment relationships were governed by Beverton-Holt dynamics with cyclical variation in population productivity (hereafter referred to as "BH_cycl"). This appendix details simulations used to parameterize the BH_cycl formulation in a manner that maintains the general system characteristics of the Kuskokwim. 

In additon to the terms in equations 1-3 there are three additoanl terms required to parameterize the BH_cyl formulation: f and A which are the period and amplitude of time varying productivity, repsecitively, and ?? which is a scalar that adjusts productivity such that long-term population equilibrium abundance in the absence of fishing is approximately the same as those under the stationary Ricker spawner-recruitment formulation.

Here is an example of a spawner-recruit relationships generated by equation 6 with F = 12, A = 0.4 and ?? = 1

```{r setup, include=FALSE}
#### Base Ricker
alpha <- colMedians(samps)[1:13]
beta <- colMedians(samps)[14:26]
Ro <- log(alpha)/beta
rick_s_eq <- sum(Ro)

com <- 0
for.error <- 0.27 # from ben (0.27)
OU <- 0.1 #(0.2 collie and peterman high end YK chum)

# set conditions for simulation
ny = 50
pm.yr <- 30

SR_rel <-  "Beverton-Holt" #"Beverton-Holt"
BH.alpha.CV <- 0.4
period <- 12
dir.SR <- "F"
num.sims<-100
alpha.multiplier <- seq(0.5,1.5,length.out=100)
outcomes.BH <- array(NA,dim=c(length(alpha.multiplier),9, num.sims))
harvest_goal = 0
egfloor =0
# run simulations!
ptm <- proc.time()
for (w in 1:length(alpha.multiplier)){
		
	for (l in 1: num.sims){
		draw <- sample(10000,1)
		alpha <- process.iteration(samps[draw,])$alpha * alpha.multiplier[w]
		beta <- process.iteration(samps[draw,])$beta
		vcov.matrix <- process.iteration(samps[draw,])$Sigma_R
		mat <- process.iteration(samps[draw,])$pi
		Rec <- process.iteration(samps[draw,])$R
		Spw <- process.iteration(samps[draw,])$S
		lst.resid <- process.iteration(samps[draw,])$last_resid
		phi <- process.iteration(samps[draw,])$phi
		
		sub <- ifelse(harvest_goal[1]<45000,harvest_goal[1],45000)
		com <- ifelse(harvest_goal[1]<45000,0,harvest_goal[1]-45000)
		
		out <- process(ny,Ro,vcov.matrix,phi,mat,alpha,beta,sub,com,egfloor[1],pm.yr,for.error,OU,Rec,Spw,lst.resid,SR_rel,BH.alpha.CV,period,dir.SR,SR_devs)
		outcomes.BH[w,,l] <- out$PMs
		}
	}	
```

To do this we transformed the Ricker spawner-recruitment relationship in equation 1 to a Beverton-Holt form (Hilborn and Walters 1992) with time varying productivity: